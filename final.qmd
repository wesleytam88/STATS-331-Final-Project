---
title: "STAT 331/531: Final Project Analysis"
author: "Jenna Chan, Swara Kurakula, Chirs Li, Wesley Tam"
format: 
  html:
    embed-resources: true
    code-tools: true
    code-fold: true
    toc: true
    number-sections: true
editor: source
  markdown: 
    wrap: sentence
execute: 
  error: true
  echo: true
  message: false
  warning: false
---

```{r setup}
library(tidyverse)
expenditure <- read_csv("data/expenditure_per_student_primary_percent_of_gdp_per_person.csv")
completion <- read_csv("data/primary_completion_rate_total_percent_of_relevant_age_group.csv")
```

## Introduction

### Detailed data and variable description.

For our project, we are using two distinct datasets to analyze the relationship between government expenditure on primary education and primary school completion rates across various countries.

**Dataset 1: Expenditure per Student, Primary (% of GDP per Person)**

This dataset contains annual data on the percentage of GDP per capita that is spent on each primary school student.

The variables included are:

1.  *Country*: The name of the country.

2.  *1995-2018*: 23 variables, 1995-2018, each representing the year of measured expenditure

```{r include=FALSE}
head(expenditure)
```

The data spans a couple decades, allowing us to observe trends and changes in educational expenditure over time. Each cell represents the expenditure per student for that year and country. For instance, in 2000, Argentina allocated 12.4% of its GDP per capita to primary education per student, while by 2013, this figure had varied.

**Dataset 2: Primary Completion Rate, Total (% of Relevant Age Group)**

This dataset provides annual data on the primary school completion rate, indicating the percentage of the relevant age group that successfully completes primary education. 

The variables included are:

1.  *Country*: The name of the country.

2.  *1970-2022*: The year for which the data is recorded.

```{r}
head(completion)
```

The data covers a wide range of years, each cell represents completion percentage for students in primary school. For example, in 1980, Afghanistan had a completion rate of 20.7%, which changed significantly over the following decades.

By combining these datasets, we aim to explore the correlation between the financial investment in education and the corresponding completion rates across different countries for the time period of 2006-2016. This analysis will help us understand the impact of educational funding on student outcomes and provide useful insights on this relationship.


Hypothesized relationship between the variables (and any outside references). 
Discussion of data cleaning process and decisions.

## Data Cleaning

We decided to limit our analysis to 2006-2016 as that time range seemed to be where the majority of the data lies without too many missing values. For acceptable measurements per year, we made sure that both the expenditure and the completion rate were recorded for that year. Any years that were missing one or the other were deemed as not acceptable for this analysis. Furthermore, countries with less than 8 acceptable measurements within the given time range were excluded from the final dataset.

```{r}
# Pivot the data
expenditure_longer <- expenditure |>
  select(country, `2006`:`2016`) |>
  pivot_longer(cols = `2006`:`2016`,
               names_to = "year",
               values_to = "expenditure")
completion_longer <- completion |>
  select(country, `2006`:`2016`) |>
  pivot_longer(cols = `2006`:`2016`,
               names_to = "year",
               values_to = "completion_rate")

# Join the datasets
joined <- expenditure_longer |>
  full_join(completion_longer,
            join_by(country == country, year == year))

# Remove countries with too little data
ACCEPTABLE_THRESHOLD <- 8
joined <- joined |>
  mutate(is_acceptable = !is.na(completion_rate) & !is.na(expenditure)) |>
  group_by(country) |>
  mutate(num_acceptable = sum(is_acceptable)) |>
  filter(num_acceptable >= ACCEPTABLE_THRESHOLD & 
         is_acceptable == TRUE)

# Summarize the Data
joined <- joined |>
  summarize(avg_expenditure = mean(expenditure),
            avg_completion = mean(completion_rate))
```
